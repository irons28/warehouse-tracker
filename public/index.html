<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Warehouse Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="app"></div>
  
  <script>
    const API_URL = window.location.origin;
    
    const app = {
      view: 'scan',
      pallets: [],
      locations: [],
      stats: {},
      activityLog: [],
      scanMode: null,
      tempPallet: null,
      searchTerm: '',
      scanner: null,
      
      async init() {
        await this.loadStats();
        await this.loadPallets();
        await this.loadLocations();
        await this.loadActivity();
        this.render();
      },
      
      async loadPallets() {
        try {
          const res = await fetch(`${API_URL}/api/pallets`);
          this.pallets = await res.json();
        } catch (e) {
          console.error('Error loading pallets:', e);
        }
      },
      
      async loadLocations() {
        try {
          const res = await fetch(`${API_URL}/api/locations`);
          this.locations = await res.json();
        } catch (e) {
          console.error('Error loading locations:', e);
        }
      },
      
      async loadStats() {
        try {
          const res = await fetch(`${API_URL}/api/stats`);
          this.stats = await res.json();
        } catch (e) {
          console.error('Error loading stats:', e);
        }
      },
      
      async loadActivity() {
        try {
          const res = await fetch(`${API_URL}/api/activity?limit=100`);
          this.activityLog = await res.json();
        } catch (e) {
          console.error('Error loading activity:', e);
        }
      },
      
      async checkIn(customerName, productId, quantity, location) {
        try {
          const res = await fetch(`${API_URL}/api/pallets`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ customer_name: customerName, product_id: productId, quantity, location })
          });
          const data = await res.json();
          alert(data.message || 'Pallet checked in!');
          await this.loadPallets();
          await this.loadStats();
          await this.loadActivity();
          this.render();
        } catch (e) {
          alert('Error checking in pallet');
          console.error(e);
        }
      },
      
      async checkOut(palletId) {
        if (!confirm('Remove entire pallet?')) return;
        try {
          const res = await fetch(`${API_URL}/api/pallets/${palletId}`, { method: 'DELETE' });
          const data = await res.json();
          alert(data.message || 'Pallet checked out!');
          await this.loadPallets();
          await this.loadStats();
          await this.loadActivity();
          this.render();
        } catch (e) {
          alert('Error checking out pallet');
          console.error(e);
        }
      },
      
      async removePartialQuantity(palletId) {
        const pallet = this.pallets.find(p => p.id === palletId);
        if (!pallet) {
          alert('Pallet not found');
          return;
        }
        
        const qtyToRemove = prompt(`Current quantity: ${pallet.quantity}\n\nHow many units to remove?`, '1');
        if (qtyToRemove === null) return;
        
        const qty = parseInt(qtyToRemove);
        if (isNaN(qty) || qty <= 0) {
          alert('Please enter a valid quantity');
          return;
        }
        
        if (qty > pallet.quantity) {
          alert(`Cannot remove ${qty} units. Only ${pallet.quantity} available.`);
          return;
        }
        
        try {
          const res = await fetch(`${API_URL}/api/pallets/${palletId}/remove-quantity`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ quantity_to_remove: qty })
          });
          const data = await res.json();
          alert(data.message || 'Quantity removed!');
          await this.loadPallets();
          await this.loadStats();
          await this.loadActivity();
          this.render();
        } catch (e) {
          alert('Error removing quantity');
          console.error(e);
        }
      },
      
      startScanner(mode) {
        this.scanMode = mode;
        this.render();
        
        setTimeout(() => {
          const html5QrCode = new Html5Qrcode("qr-reader");
          this.scanner = html5QrCode;
          
          // Request camera permissions first
          Html5Qrcode.getCameras().then(cameras => {
            if (cameras && cameras.length > 0) {
              // Use back camera if available (better for scanning)
              const cameraId = cameras.length > 1 ? cameras[1].id : cameras[0].id;
              
              html5QrCode.start(
                cameraId,
                {
                  fps: 10,
                  qrbox: { width: 250, height: 250 },
                  aspectRatio: 1.0
                },
                (decodedText) => {
                  this.handleScan(decodedText);
                  html5QrCode.stop().catch(err => console.log('Stop error:', err));
                },
                (errorMessage) => {
                  // Scanning errors are normal, ignore them
                }
              ).catch(err => {
                console.error("Camera start error:", err);
                alert("Camera access denied or not available. Please enable camera permissions in your browser settings, then try again.");
                this.stopScanner();
                this.scanMode = null;
                this.render();
              });
            } else {
              alert("No cameras found on this device. Please use manual entry.");
              this.stopScanner();
              this.scanMode = null;
              this.render();
            }
          }).catch(err => {
            console.error("Camera detection error:", err);
            alert("Unable to access camera. Please ensure:\n1. You're using HTTPS (or localhost)\n2. Camera permissions are enabled\n3. No other app is using the camera\n\nUse manual entry instead.");
            this.stopScanner();
            this.scanMode = null;
            this.render();
          });
        }, 100);
      },
      
      handleScan(code) {
        if (this.scanMode === 'checkin-pallet') {
          this.tempPallet = code;
          this.stopScanner();
          setTimeout(() => {
            this.scanMode = 'checkin-location';
            this.startScanner('checkin-location');
          }, 500);
        } else if (this.scanMode === 'checkin-location') {
          this.stopScanner();
          const customerName = prompt('Enter Customer Name:');
          if (!customerName) {
            this.scanMode = null;
            this.tempPallet = null;
            this.render();
            return;
          }
          const qty = prompt('Enter quantity:', '1');
          if (qty !== null) {
            this.checkIn(customerName, this.tempPallet, parseInt(qty) || 1, code);
          }
          this.scanMode = null;
          this.tempPallet = null;
        } else if (this.scanMode === 'checkout') {
          this.stopScanner();
          this.checkOut(code);
          this.scanMode = null;
        }
      },
      
      stopScanner() {
        if (this.scanner) {
          try {
            this.scanner.stop().then(() => {
              this.scanner.clear();
            }).catch(e => {
              console.log('Scanner stop error:', e);
            });
          } catch (e) {
            console.log('Scanner already stopped');
          }
          this.scanner = null;
        }
      },
      
      showManualEntry() {
        const customerName = prompt('Enter Customer Name (e.g., Godbold, Council):');
        if (!customerName) return;
        
        const productId = prompt('Enter Product ID:');
        if (!productId) return;
        
        const quantity = prompt('Enter Quantity:', '1');
        const location = prompt('Enter Location (e.g., A1-L3):');
        
        if (location) {
          this.checkIn(customerName, productId, parseInt(quantity) || 1, location);
        }
      },
      
      async generateQRCode(text, containerId) {
        return new Promise((resolve) => {
          setTimeout(() => {
            const container = document.getElementById(containerId);
            if (container) {
              // Clear any existing QR code
              container.innerHTML = '';
              
              try {
                // Use QRCode.js library (different from canvas-based)
                new QRCode(container, {
                  text: text,
                  width: 200,
                  height: 200,
                  colorDark: "#000000",
                  colorLight: "#ffffff",
                  correctLevel: QRCode.CorrectLevel.H
                });
                resolve();
              } catch (error) {
                console.error('QR Code generation error:', error);
                resolve();
              }
            } else {
              console.error('Container not found:', containerId);
              resolve();
            }
          }, 100);
        });
      },
      
      async showQRGenerator() {
        this.view = 'qr-generator';
        this.render();
      },
      
      async generateLocationQRs() {
        this.view = 'location-qrs';
        this.render();
        
        // Generate QR codes after render
        setTimeout(async () => {
          const aisles = this.locations.reduce((acc, loc) => {
            if (!acc.includes(loc.aisle)) acc.push(loc.aisle);
            return acc;
          }, []).sort();
          
          for (const aisle of aisles) {
            const aisleLocations = this.locations.filter(l => l.aisle === aisle);
            for (const loc of aisleLocations) {
              await this.generateQRCode(loc.id, `qr-${loc.id}`);
            }
          }
        }, 200);
      },
      
      async generatePalletQR() {
        const palletId = prompt('Enter Pallet ID (or leave blank for auto-generated):');
        const finalId = palletId || `PLT-${Date.now()}`;
        
        const customerName = prompt('Enter Customer Name:');
        if (!customerName) return;
        
        const productDesc = prompt('Enter Product Description (optional):', '');
        const quantity = prompt('Enter Quantity:', '1');
        
        this.view = 'single-qr';
        this.tempPallet = {
          id: finalId,
          customer: customerName,
          product: productDesc,
          quantity: parseInt(quantity) || 1
        };
        this.render();
        
        setTimeout(async () => {
          await this.generateQRCode(finalId, 'single-qr-canvas');
        }, 100);
      },
      
      printQRCodes() {
        window.print();
      },
      
      render() {
        const filtered = this.pallets.filter(p => 
          p.product_id.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
          p.location.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
          p.customer_name.toLowerCase().includes(this.searchTerm.toLowerCase())
        );
        
        document.getElementById('app').innerHTML = `
          <div class="bg-blue-600 text-white p-4 shadow-lg print:hidden">
            <h1 class="text-2xl font-bold">Warehouse Tracker</h1>
            <div class="mt-2 text-sm">
              <span class="mr-4">üì¶ ${this.stats.total_pallets || 0} Pallets</span>
              <span class="mr-4">‚úì ${this.stats.occupied_locations || 0} Occupied</span>
              <span>‚ñ° ${(this.stats.total_locations || 480) - (this.stats.occupied_locations || 0)} Available</span>
            </div>
          </div>
          
          <div class="bg-white border-b sticky top-0 z-10 flex print:hidden">
            <button onclick="app.view='scan'; app.render()" class="flex-1 py-3 ${this.view === 'scan' ? 'bg-blue-50 text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}">
              üì∑ Scan
            </button>
            <button onclick="app.view='inventory'; app.render()" class="flex-1 py-3 ${this.view === 'inventory' ? 'bg-blue-50 text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}">
              üìã Inventory
            </button>
            <button onclick="app.view='qr-generator'; app.render()" class="flex-1 py-3 ${this.view === 'qr-generator' ? 'bg-blue-50 text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}">
              üè∑Ô∏è QR Codes
            </button>
            <button onclick="app.view='history'; app.render()" class="flex-1 py-3 ${this.view === 'history' ? 'bg-blue-50 text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}">
              üìú History
            </button>
          </div>
          
          <div class="p-4">
            ${this.view === 'scan' ? this.renderScan() : 
              this.view === 'inventory' ? this.renderInventory(filtered) :
              this.view === 'qr-generator' ? this.renderQRGenerator() :
              this.view === 'location-qrs' ? this.renderLocationQRs() :
              this.view === 'single-qr' ? this.renderSingleQR() :
              this.renderHistory()}
          </div>
        `;
        
        if (this.view === 'inventory') {
          this.attachSearchListener();
        }
      },
      
      attachSearchListener() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
          const newSearchInput = searchInput.cloneNode(true);
          searchInput.parentNode.replaceChild(newSearchInput, searchInput);
          
          newSearchInput.addEventListener('input', (e) => {
            this.searchTerm = e.target.value;
            const filtered = this.pallets.filter(p => 
              p.product_id.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
              p.location.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
              p.customer_name.toLowerCase().includes(this.searchTerm.toLowerCase())
            );
            
            const resultsDiv = document.querySelector('.space-y-2');
            if (resultsDiv) {
              resultsDiv.innerHTML = filtered.length === 0 ? 
                '<div class="text-center text-gray-500 py-8 text-lg">No pallets found</div>' :
                filtered.map(p => `
                  <div class="bg-white p-4 rounded-lg shadow flex justify-between items-start">
                    <div class="flex-1">
                      <h3 class="font-bold text-lg">${p.product_id}</h3>
                      <p class="text-blue-600 font-semibold">üë§ ${p.customer_name}</p>
                      <p class="text-gray-600">üìç ${p.location}</p>
                      <p class="text-sm text-gray-500">Qty: ${p.quantity} ‚Ä¢ ${new Date(p.date_added).toLocaleDateString()}</p>
                    </div>
                    <div class="flex flex-col gap-2">
                      <button onclick="app.removePartialQuantity('${p.id}')" class="bg-orange-500 text-white px-3 py-2 rounded text-sm hover:bg-orange-600">
                        Remove Qty
                      </button>
                      <button onclick="app.checkOut('${p.id}')" class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                        Remove All
                      </button>
                    </div>
                  </div>
                `).join('');
            }
          });
        }
      },
      
      renderScan() {
        if (!this.scanMode) {
          return `
            <div class="space-y-3">
              <button onclick="app.startScanner('checkin-pallet')" class="w-full bg-green-500 text-white p-4 rounded-lg shadow hover:bg-green-600 text-lg">
                ‚úì Check In Pallet
              </button>
              <button onclick="app.startScanner('checkout')" class="w-full bg-red-500 text-white p-4 rounded-lg shadow hover:bg-red-600 text-lg">
                ‚úó Check Out Pallet
              </button>
              <button onclick="app.showManualEntry()" class="w-full bg-gray-500 text-white p-4 rounded-lg shadow hover:bg-gray-600 text-lg">
                ‚úé Manual Entry
              </button>
            </div>
          `;
        } else {
          return `
            <div class="space-y-4">
              <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-bold mb-2 text-lg">
                  ${this.scanMode === 'checkin-pallet' ? 'üì¶ Step 1: Scan Pallet QR Code' : 
                    this.scanMode === 'checkin-location' ? 'üìç Step 2: Scan Location QR Code' : 
                    'üì¶ Scan Pallet to Remove'}
                </h3>
                ${this.tempPallet ? `<p class="text-green-600 font-semibold">‚úì Pallet: ${this.tempPallet}</p>` : ''}
              </div>
              
              <div id="qr-reader" class="border-4 border-blue-500 rounded-lg overflow-hidden"></div>
              
              <button onclick="app.stopScanner(); app.scanMode = null; app.tempPallet = null; app.render()" class="w-full bg-gray-500 text-white p-3 rounded-lg text-lg">
                Cancel
              </button>
            </div>
          `;
        }
      },
      
      renderQRGenerator() {
        return `
          <div class="space-y-4">
            <div class="bg-white p-6 rounded-lg shadow">
              <h2 class="text-xl font-bold mb-4">QR Code Generator</h2>
              <p class="text-gray-600 mb-6">Generate QR codes for scanning pallets and locations</p>
              
              <div class="space-y-3">
                <button onclick="app.generatePalletQR()" class="w-full bg-blue-500 text-white p-4 rounded-lg shadow hover:bg-blue-600 text-lg">
                  üè∑Ô∏è Generate Pallet QR Code
                </button>
                
                <button onclick="app.generateLocationQRs()" class="w-full bg-purple-500 text-white p-4 rounded-lg shadow hover:bg-purple-600 text-lg">
                  üìç Generate All Location QR Codes
                </button>
              </div>
            </div>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
              <p class="text-sm text-yellow-800">
                <strong>Tip:</strong> After generating QR codes, use your browser's print function to print labels. 
                Location QR codes are organized by aisle for easy labeling.
              </p>
            </div>
          </div>
        `;
      },
      
      renderSingleQR() {
        const pallet = this.tempPallet;
        return `
          <div class="max-w-md mx-auto">
            <div id="print-label" class="bg-white p-6 rounded-lg shadow text-center border-2 border-gray-300">
              <h2 class="text-xl font-bold mb-2 print:text-2xl">Pallet Label</h2>
              
              <div class="bg-gray-50 p-4 rounded-lg inline-block mb-4">
                <div id="single-qr-canvas"></div>
              </div>
              
              <div class="border-t-2 border-gray-300 pt-4 text-left">
                <div class="mb-2">
                  <span class="text-gray-600 text-sm">Pallet ID:</span>
                  <p class="font-mono text-lg font-bold">${pallet.id}</p>
                </div>
                
                <div class="mb-2">
                  <span class="text-gray-600 text-sm">Customer:</span>
                  <p class="font-semibold text-lg">${pallet.customer}</p>
                </div>
                
                ${pallet.product ? `
                  <div class="mb-2">
                    <span class="text-gray-600 text-sm">Product:</span>
                    <p class="font-medium">${pallet.product}</p>
                  </div>
                ` : ''}
                
                <div class="mb-2">
                  <span class="text-gray-600 text-sm">Quantity:</span>
                  <p class="font-bold text-xl text-blue-600">${pallet.quantity}</p>
                </div>
                
                <div class="text-xs text-gray-500 mt-4">
                  Generated: ${new Date().toLocaleString()}
                </div>
              </div>
            </div>
            
            <div class="mt-6 space-y-2 print:hidden">
              <button onclick="app.printQRCodes()" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600">
                üñ®Ô∏è Print Label
              </button>
              <button onclick="app.generatePalletQR()" class="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600">
                Generate Another
              </button>
              <button onclick="app.view='qr-generator'; app.render()" class="w-full bg-gray-300 text-gray-700 p-3 rounded-lg hover:bg-gray-400">
                Back
              </button>
            </div>
          </div>
          
          <style>
            @media print {
              body * { visibility: hidden; }
              #print-label, #print-label * { visibility: visible; }
              #print-label { 
                position: absolute; 
                left: 50%; 
                top: 50%; 
                transform: translate(-50%, -50%);
                border: 2px solid #000;
                padding: 20px;
              }
            }
          </style>
        `;
      },
      
      renderLocationQRs() {
        const aisles = this.locations.reduce((acc, loc) => {
          if (!acc.includes(loc.aisle)) acc.push(loc.aisle);
          return acc;
        }, []).sort();
        
        return `
          <div class="print:p-0">
            <div class="mb-4 print:hidden">
              <button onclick="app.printQRCodes()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 mr-2">
                üñ®Ô∏è Print All QR Codes
              </button>
              <button onclick="app.view='qr-generator'; app.render()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
                Back
              </button>
            </div>
            
            ${aisles.map(aisle => {
              const aisleLocations = this.locations.filter(l => l.aisle === aisle);
              return `
                <div class="mb-8 print:break-after-page">
                  <h2 class="text-2xl font-bold mb-4 print:text-3xl">Aisle ${aisle}</h2>
                  <div class="grid grid-cols-4 gap-4 print:grid-cols-6 print:gap-2">
                    ${aisleLocations.map(loc => `
                      <div class="bg-white p-3 rounded-lg shadow text-center print:border print:border-gray-300">
                        <div id="qr-${loc.id}" class="mx-auto flex items-center justify-center" style="min-height: 120px;"></div>
                        <p class="mt-2 font-mono text-sm font-semibold print:text-xs">${loc.id}</p>
                      </div>
                    `).join('')}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
          
          <style>
            @media print {
              .print\\:hidden { display: none !important; }
              .print\\:break-after-page { page-break-after: always; }
              body { background: white; }
              .print\\:p-0 { padding: 0; }
              .print\\:border { border: 1px solid #d1d5db; }
              .print\\:grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
              .print\\:gap-2 { gap: 0.5rem; }
              .print\\:text-3xl { font-size: 1.875rem; }
              .print\\:text-xs { font-size: 0.75rem; }
            }
          </style>
        `;
      },
      
      renderInventory(pallets) {
        return `
          <div class="mb-4 flex gap-2">
            <input 
              id="search-input"
              type="text" 
              placeholder="Search customer, product or location..." 
              value="${this.searchTerm}"
              class="flex-1 border p-3 rounded text-lg"
            />
            <a href="${API_URL}/api/export" download class="bg-blue-500 text-white px-4 py-3 rounded flex items-center">
              ‚¨á Export
            </a>
          </div>
          
          <div class="space-y-2">
            ${pallets.length === 0 ? 
              '<div class="text-center text-gray-500 py-8 text-lg">No pallets found</div>' :
              pallets.map(p => `
                <div class="bg-white p-4 rounded-lg shadow flex justify-between items-start">
                  <div class="flex-1">
                    <h3 class="font-bold text-lg">${p.product_id}</h3>
                    <p class="text-blue-600 font-semibold">üë§ ${p.customer_name}</p>
                    <p class="text-gray-600">üìç ${p.location}</p>
                    <p class="text-sm text-gray-500">Qty: ${p.quantity} ‚Ä¢ Added: ${new Date(p.date_added).toLocaleDateString()}</p>
                  </div>
                  <div class="flex flex-col gap-2">
                    <button onclick="app.removePartialQuantity('${p.id}')" class="bg-orange-500 text-white px-3 py-2 rounded text-sm hover:bg-orange-600">
                      Remove Qty
                    </button>
                    <button onclick="app.checkOut('${p.id}')" class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                      Remove All
                    </button>
                  </div>
                </div>
              `).join('')
            }
          </div>
        `;
      },
      
      renderHistory() {
        const getActionBadge = (action) => {
          if (action === 'CHECK_IN') return '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold">‚úì Check In</span>';
          if (action === 'CHECK_OUT') return '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-semibold">‚úó Check Out</span>';
          if (action === 'PARTIAL_REMOVE') return '<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-semibold">‚Üì Partial Remove</span>';
          return action;
        };
        
        return `
          <div class="mb-4">
            <h2 class="text-xl font-bold text-gray-800">Activity History</h2>
            <p class="text-sm text-gray-600">Last 100 activities</p>
          </div>
          
          <div class="space-y-2">
            ${this.activityLog.length === 0 ? 
              '<div class="text-center text-gray-500 py-8 text-lg">No activity yet</div>' :
              this.activityLog.map(a => `
                <div class="bg-white p-4 rounded-lg shadow">
                  <div class="flex justify-between items-start mb-2">
                    <div class="flex-1">
                      <h3 class="font-bold text-lg">${a.product_id}</h3>
                      <p class="text-blue-600 font-semibold text-sm">üë§ ${a.customer_name}</p>
                    </div>
                    ${getActionBadge(a.action)}
                  </div>
                  
                  <div class="grid grid-cols-2 gap-2 text-sm mt-2">
                    <div>
                      <span class="text-gray-600">Location:</span>
                      <span class="font-semibold ml-1">${a.location}</span>
                    </div>
                    ${a.action === 'PARTIAL_REMOVE' || a.action === 'CHECK_OUT' ? `
                      <div>
                        <span class="text-gray-600">Removed:</span>
                        <span class="font-semibold ml-1 text-red-600">${a.quantity_changed}</span>
                      </div>
                    ` : ''}
                    ${a.action === 'PARTIAL_REMOVE' ? `
                      <div>
                        <span class="text-gray-600">Before:</span>
                        <span class="font-semibold ml-1">${a.quantity_before}</span>
                      </div>
                      <div>
                        <span class="text-gray-600">After:</span>
                        <span class="font-semibold ml-1">${a.quantity_after}</span>
                      </div>
                    ` : ''}
                    ${a.action === 'CHECK_IN' ? `
                      <div>
                        <span class="text-gray-600">Quantity:</span>
                        <span class="font-semibold ml-1 text-green-600">${a.quantity_after}</span>
                      </div>
                    ` : ''}
                  </div>
                  
                  ${a.notes ? `<p class="text-xs text-gray-500 mt-2 italic">${a.notes}</p>` : ''}
                  
                  <p class="text-xs text-gray-400 mt-2">
                    üìÖ ${new Date(a.timestamp).toLocaleString()}
                  </p>
                </div>
              `).join('')
            }
          </div>
        `;
      }
    };
    
    app.init();
  </script>
</body>
</html>